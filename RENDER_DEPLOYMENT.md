# Render.com Deployment Guide

This guide will help you deploy Retail Brain on Render.com's free tier.

## ğŸ¯ What You Get (Free Tier)

- âœ… PostgreSQL Database (Free tier - 90 days, then $7/month)
- âœ… Redis (Free tier - 25MB)
- âœ… 3 Web Services (Free tier - spins down after 15min inactivity)
- âœ… Automatic HTTPS
- âœ… Persistent storage for MLflow artifacts

## ğŸ“‹ Prerequisites

1. **GitHub Account** - Your code must be in a GitHub repository
2. **Render Account** - Sign up at https://render.com (free)

## ğŸš€ Deployment Steps

### Step 1: Push Code to GitHub

```bash
# If not already on GitHub
git remote add origin https://github.com/yourusername/braintel.git
git push -u origin main
```

### Step 2: Create Render Account

1. Go to https://render.com
2. Sign up with GitHub (recommended)
3. Authorize Render to access your repositories

### Step 3: Deploy via Blueprint

1. In Render Dashboard, click **"New +"** â†’ **"Blueprint"**
2. Connect your GitHub repository
3. Select the repository containing `render.yaml`
4. Render will detect the `render.yaml` file automatically
5. Click **"Apply"** to deploy all services

### Step 4: Configure Environment Variables

After deployment, you need to set one environment variable manually:

1. Go to **API Gateway** service â†’ **Environment** tab
2. Add:
   ```
   API_GATEWAY_API_KEYS=your-secret-key-1,your-secret-key-2
   ```
   Generate secure keys:
   ```bash
   openssl rand -hex 32
   ```

### Step 5: Run Database Migrations

After PostgreSQL is ready, run migrations:

1. Go to **API Gateway** service â†’ **Shell** tab
2. Or use Render's **Shell** feature
3. Run:
   ```bash
   # Install dependencies first
   pnpm install
   
   # Run migrations
   pnpm db:migrate
   ```

### Step 6: Access Your Services

After deployment, you'll get URLs like:

- **API Gateway**: `https://retail-brain-api-gateway.onrender.com`
- **Event Collector**: `https://retail-brain-event-collector.onrender.com`
- **MLflow**: `https://retail-brain-mlflow.onrender.com`

## âš™ï¸ Service URLs Configuration

The services need to know each other's URLs. Update these in Render:

### API Gateway Environment Variables

Add these to your API Gateway service:

```
EVENT_COLLECTOR_URL=https://retail-brain-event-collector.onrender.com
PROFILE_SERVICE_URL=https://retail-brain-profile-service.onrender.com
IDENTITY_ENGINE_URL=https://retail-brain-identity-engine.onrender.com
# ... add other service URLs as needed
```

## ğŸ”„ Free Tier Limitations

### Important Notes:

1. **Service Spin-Down**: Free tier services spin down after 15 minutes of inactivity
   - First request after spin-down takes ~30-60 seconds
   - Consider upgrading to paid plan for always-on services

2. **PostgreSQL Free Tier**: 
   - Free for 90 days
   - After that, $7/month for the smallest plan
   - Data persists even if you don't upgrade

3. **Redis Free Tier**:
   - 25MB storage limit
   - Sufficient for development/testing

4. **Web Services**:
   - 512MB RAM limit
   - 0.1 CPU share
   - May need to optimize for production workloads

## ğŸ› ï¸ Troubleshooting

### Services Not Starting

1. Check **Logs** tab in Render dashboard
2. Common issues:
   - Database connection errors â†’ Wait for PostgreSQL to be ready
   - Port binding errors â†’ Ensure services use `$PORT` environment variable
   - Build failures â†’ Check Dockerfile paths

### Database Connection Issues

1. Verify environment variables are set correctly
2. Check that PostgreSQL service is **Ready** (green status)
3. Ensure `POSTGRES_HOST` uses the internal Render hostname (auto-set)

### Service URLs Not Working

1. Free tier services take 30-60 seconds to wake up
2. Check service status in Render dashboard
3. Verify HTTPS URLs (Render forces HTTPS)

## ğŸ“Š Monitoring

- **Logs**: Available in each service's **Logs** tab
- **Metrics**: Basic metrics available in free tier
- **Alerts**: Set up in **Alerts** tab (requires paid plan for email/Slack)

## ğŸ” Security Notes

1. **API Keys**: Generate strong keys using:
   ```bash
   openssl rand -hex 32
   ```

2. **Database Passwords**: Auto-generated by Render (secure)

3. **HTTPS**: Automatic for all services (free)

4. **Environment Variables**: Never commit `.env` files

## ğŸš€ Next Steps

1. **Custom Domain**: Add your domain in **Settings** â†’ **Custom Domains**
2. **Upgrade Plan**: For production, consider paid plans for:
   - Always-on services (no spin-down)
   - More RAM/CPU
   - Better performance
3. **Backup Strategy**: Set up automated backups for PostgreSQL

## ğŸ“ Support

- Render Docs: https://render.com/docs
- Render Community: https://community.render.com
- Status Page: https://status.render.com

